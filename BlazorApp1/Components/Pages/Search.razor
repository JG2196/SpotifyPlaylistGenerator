@using OpenAI.Chat
@inject NavigationManager NavigationManager

@page "/search"
@rendermode InteractiveServer

@* <head>
    <meta charset="utf-8" />
    <title>Spotify App</title>
    <script src="~/bootstrap/spotify.js" type="module"></script>
</head> *@

<PageTitle>Search</PageTitle>

<h1>Search</h1>

@* <input style="width:400px" placeholder="Search..." id="" /> *@

<input @bind="PromptText" placeholder="Enter text here" style="width:400px" />
<button @onclick="SubmitPrompt">Submit</button>

@* <button onclick="testFunction()">JS link. CLICK ME!!!</button> *@
<button @onclick="AuthorizeSpotify">JS link. CLICK ME!!!</button>

<p>You entered: @ResponseText</p>
@code {
    // private string InputText { get; set; } = "";
    // private string SubmittedText { get; set; } = "";

    // private void SubmitText()
    // {
    //     SubmittedText = InputText;
    //     Console.WriteLine("SubmittedText: " + SubmittedText);
    // }

    private string PromptText { get; set; } = "";
    private string ResponseText { get; set; } = "";

    private void SubmitPrompt()
    {
        ChatClient client = new(model: "gpt-4o-mini", apiKey: "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");

        ChatCompletion completion = client.CompleteChat(PromptText);

        ResponseText = completion.Content[0].Text;

    }

    @code {
        private void AuthorizeSpotify()
        {
            var clientId = "6c920f46f61c4d6f8274777f892531b7";
            var redirectUri = "https://localhost:7262/search";
            var scopes = "user-read-private user-read-email";

            var url = $"https://accounts.spotify.com/authorize?client_id={clientId}&response_type=code&redirect_uri={Uri.EscapeDataString(redirectUri)}&scope={Uri.EscapeDataString(scopes)}";
            // NavigateTo(url, true);
            // Navigation.NavigateTo(url, true);
            
            NavigationManager.NavigateTo(url, true);
        }
    }
}
